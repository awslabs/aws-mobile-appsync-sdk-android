before_install:
- openssl aes-256-cbc -K $encrypted_db266f166009_key -iv $encrypted_db266f166009_iv -in aws-android-sdk-appsync-tests/src/main/assets/awsconfiguration.json.enc -out aws-android-sdk-appsync-tests/src/main/res/raw/awsconfiguration.json -d
- ls -l aws-android-sdk-appsync-tests/src/main/res/raw/awsconfiguration.json
- wc aws-android-sdk-appsync-tests/src/main/res/raw/awsconfiguration.json
- chmod +x gradlew
- yes | sdkmanager "platforms;android-25"
- yes | sdkmanager tools
- android list target
- echo no | avdmanager create avd --force -n test -k "system-images;android-25;google_apis;armeabi-v7a"
- emulator -avd test -no-skin -no-audio -no-window &
- android-wait-for-emulator
- adb -e logcat *:I | tee logcat.log > /dev/null 2>&1 &
- adb shell input keyevent 82 &
language: android
android:
  components:
    - tools
    - platform-tools
    - tools
    - build-tools-28.0.2
    - build-tools-25.0.3
    - android-28
    - android-25
    - sys-img-armeabi-v7a-android-25
script:
- ./gradlew publishToMavenLocal
- cd aws-android-sdk-appsync-tests
- android list target
- "./gradlew build connectedCheck --stacktrace "
- cd ..
after_failure:
- cat aws-android-sdk-appsync-tests/build/outputs/androidTest-results/connected/*.xml
- echo " LOGCAT "; echo "========"; cat logcat.log; pkill -KILL -f adb
