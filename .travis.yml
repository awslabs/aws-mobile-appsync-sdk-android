before_install:
- ls -l aws-android-sdk-appsync-tests/src/main/res/raw/awsconfiguration.json
- wc aws-android-sdk-appsync-tests/src/main/res/raw/awsconfiguration.json
- chmod +x gradlew
- yes | sdkmanager "platforms;android-27"
- yes | sdkmanager tools
- sdkmanager "system-images;android-27;google_apis;x86"
- android list target
- echo no | avdmanager create avd --force -n test -k "system-images;android-27;google_apis;x86"
- $ANDROID_HOME/emulator/emulator -avd test -no-skin -no-audio -no-window &
- android-wait-for-emulator
- adb -e logcat *:I | tee logcat.log > /dev/null 2>&1 &
- adb shell input keyevent 82 &
language: android
android:
  components:
  - tools
  - platform-tools
  - tools
  - build-tools-27.0.3
  - android-27
  - android-22
script:
- ./gradlew publishToMavenLocal
- cd aws-android-sdk-appsync-tests
- android list target
- "./gradlew build connectedCheck --stacktrace "
- cd ..
after_failure:
  - cat aws-android-sdk-appsync-tests/build/outputs/androidTest-results/connected/*.xml
  - echo " LOGCAT "; echo "========"; cat logcat.log; pkill -KILL -f adb
